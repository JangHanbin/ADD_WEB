{% extends "bootstrap/base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% block title %}ADD Demo page{% endblock %}

{% block head %}
{{super()}}
<!--<link rel="stylesheet" href="{{url_for('static', filename='/css/json-beauty1.css')}}">-->
<!--<link rel="stylesheet" href="{{url_for('static', filename='/css/json-beauty2.css')}}">-->
{% endblock %}
{% block navbar %}
<div class="navbar navbar-fixed-top">
	<!-- ... -->
</div>
{% endblock %}

{% block content %}
<div class="container">
	<h1>Threat Intelligence</h1>
	<ul class="nav nav-tabs">
		<li role="presentation" class="active"><a href="#">Home</a></li>
		<li role="presentation"><a href="#">Grouping</a></li>
		<li role="presentation"><a href="#">Visualize</a></li>
	</ul>

	<form class="navbar-form navbar-left" role="search" action="api" method="POST">
		<div class="form-group">
			<input type="text" id="keyword" name="keyword" class="form-control" placeholder="Keyword">
			<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
		</div>
		<button id="call-api" type="button" class="btn btn-default" onclick="fnGetObjects()" >Search</button>
	</form>
	<div id="loading" style="display:none;"><img src="/static/loading.gif" alt="" style="width:50%; margin:0 auto"/></div>
	<br><br>

	<hr>
	{{wtf.quick_form(form)}}
	<hr>


</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script>
    function fnGetObjects(){
        var keyword = $('#keyword').val();
        var csrf_token = "{{ csrf_token() }}";

        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrf_token);
                }
            }
        });
        function replacer(key, value) {
  // Filtering out properties
  if (typeof value === 'string') {
    return undefined;
  }
  return value;
}


        $('#loading').show();
        $.ajax({

            type : 'POST',
            url : 'api',
            data : {
                'keyword': keyword
            },
            dataType : 'JSON',

            complete: function () {
                $('#loading').hide()

            },
            success : function(result){
                $('#result').val(JSON.stringify(result, null, '\t'))


                // alert("result = "+ result);
            },

            error : function(xtr,status,error){
                alert(xtr +":"+status+":"+error);
            }
        });
    }



</script>
{% endblock %}